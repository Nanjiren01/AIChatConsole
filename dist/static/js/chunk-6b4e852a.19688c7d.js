(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6b4e852a"],{"1f06":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:"提示",visible:e.passwordDialogVisible,width:"400px","append-to-body":!0,"close-on-click-modal":!1},on:{close:e.handlePasswordDialogClose}},[a("el-form",{ref:"passwordForm",attrs:{"label-width":"80px"}},[e.showOldPassword?a("el-form-item",{attrs:{label:"旧密码"}},[a("el-input",{model:{value:e.passwordDialogInfo.oldPassword,callback:function(t){e.$set(e.passwordDialogInfo,"oldPassword",t)},expression:"passwordDialogInfo.oldPassword"}})],1):e._e(),a("el-form-item",{attrs:{label:"新密码"}},[a("el-input",{model:{value:e.passwordDialogInfo.newPassword,callback:function(t){e.$set(e.passwordDialogInfo,"newPassword",t)},expression:"passwordDialogInfo.newPassword"}})],1),a("el-form-item",{attrs:{label:"确认密码"}},[a("el-input",{model:{value:e.passwordDialogInfo.newPassword2,callback:function(t){e.$set(e.passwordDialogInfo,"newPassword2",t)},expression:"passwordDialogInfo.newPassword2"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.handlePasswordDialogClose}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.handlePasswordChangeSubmit}},[e._v("确定修改")])],1)],1)},o=[],l=a("c24f"),s={name:"PasswordChangeDialog",props:{passwordDialogVisible:{type:Boolean,default:!1},showOldPassword:{type:Boolean,default:!1}},data:function(){return{passwordDialogInfo:{userId:null,oldPassword:"",newPassword:"",newPassword2:""}}},methods:{init:function(e){this.passwordDialogInfo.userId=e,this.passwordDialogInfo.oldPassword="",this.passwordDialogInfo.newPassword="",this.passwordDialogInfo.newPassword2=""},handlePasswordDialogClose:function(){this.$emit("close")},handlePasswordChangeSubmit:function(){var e=this;if(this.showOldPassword){if(!this.passwordDialogInfo.oldPassword)return void this.$message.error("请输入旧密码！");if(this.passwordDialogInfo.oldPassword.length<6||this.passwordDialogInfo.oldPassword.length>64)return void this.$message.error("旧密码长度应该在6-64之间！")}this.passwordDialogInfo.newPassword?this.passwordDialogInfo.newPassword.length<6||this.passwordDialogInfo.newPassword.length>64?this.$message.error("新密码长度应该在6-64之间！"):this.passwordDialogInfo.newPassword2?this.passwordDialogInfo.newPassword===this.passwordDialogInfo.newPassword2?Object(l["a"])(this.passwordDialogInfo.userId,this.passwordDialogInfo.oldPassword,this.passwordDialogInfo.newPassword).then((function(t){console.log("resp",t),e.$message.success("修改密码成功！"),e.$emit("close")})):this.$message.error("两次输入的密码不一致！"):this.$message.error("请输入确认密码！"):this.$message.error("请输入新密码！")}}},i=s,r=a("2877"),c=Object(r["a"])(i,n,o,!1,null,null,null);t["a"]=c.exports},5793:function(e,t,a){"use strict";a("a8a8")},"618b":function(e,t,a){},"6dff":function(e,t,a){"use strict";a("e32a")},"757a":function(e,t,a){"use strict";a("618b")},a1f4:function(e,t,a){"use strict";a.d(t,"c",(function(){return o})),a.d(t,"a",(function(){return l})),a.d(t,"f",(function(){return s})),a.d(t,"e",(function(){return i})),a.d(t,"d",(function(){return r})),a.d(t,"b",(function(){return c}));var n=a("b775");function o(){return Object(n["a"])({url:"/package/all",method:"get"})}function l(e){return Object(n["a"])({url:"/package",method:"post",data:e})}function s(e){return Object(n["a"])({url:"/package",method:"put",data:e})}function i(e){return Object(n["a"])({url:"/package/".concat(e,"/onSales"),method:"put"})}function r(e){return Object(n["a"])({url:"/package/".concat(e,"/offShelves"),method:"put"})}function c(e){return Object(n["a"])({url:"/package/".concat(e),method:"delete"})}},a8a8:function(e,t,a){},e32a:function(e,t,a){},f2f4:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page-container"},[a("ai-table",{attrs:{"table-actions":e.tableActions,"table-columns":e.tableColumns,"table-data":e.tableData,"table-action-column":e.tableActionColumn,pagination:e.pagination,loading:e.loading},on:{pageSizeChanged:e.handlePageSizeChange,pageCurrentChanged:e.handlePageCurrentChanged,refresh:e.handleRefresh},scopedSlots:e._u([{key:"filter",fn:function(){return[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:6,xs:24}},[a("el-input",{attrs:{placeholder:"请输入用户名"},model:{value:e.filter.username,callback:function(t){e.$set(e.filter,"username",t)},expression:"filter.username"}})],1),a("el-col",{attrs:{span:6,xs:24}},[a("el-input",{attrs:{placeholder:"请输入邮箱"},model:{value:e.filter.email,callback:function(t){e.$set(e.filter,"email",t)},expression:"filter.email"}})],1),a("el-col",{attrs:{span:6,xs:24}},[a("el-button",{attrs:{type:"primary",plain:"",disabled:e.loading},on:{click:e.handleSearch}},[e._v("搜索")]),a("el-button",{attrs:{type:"info",plain:""},on:{click:e.handleResetFilter}},[e._v("重置")])],1)],1)]},proxy:!0},{key:"topActions",fn:function(){},proxy:!0},{key:"rowActions",fn:function(t){return[a("el-button",{attrs:{icon:"el-icon-edit"},on:{click:function(a){return a.stopPropagation(),e.handleEdit(t.row)}}},[e._v("编辑")]),a("el-button",{on:{click:function(a){return a.stopPropagation(),e.handleToggleEnable(t.row)}}},[e._v(" "+e._s(1==t.row.state?"停用":"取消停用")+" ")])]}},{key:"tokens",fn:function(t){return[-1==t.row.tokens?a("el-tag",{attrs:{type:"success"}},[e._v("无限制")]):0===t.row.tokens?a("el-tag",{attrs:{type:"danger"}},[e._v(e._s(t.row.tokens))]):t.row.tokens<50?a("el-tag",{attrs:{type:"warning"}},[e._v(e._s(t.row.tokens))]):a("el-tag",{attrs:{type:"success"}},[e._v(e._s(t.row.tokens))])]}},{key:"chatCount",fn:function(t){return[-1==t.row.chatCount?a("el-tag",{attrs:{type:"success"}},[e._v("无限制")]):0===t.row.chatCount?a("el-tag",{attrs:{type:"danger"}},[e._v(e._s(t.row.chatCount))]):t.row.chatCount<5?a("el-tag",{attrs:{type:"warning"}},[e._v(e._s(t.row.chatCount))]):a("el-tag",{attrs:{type:"success"}},[e._v(e._s(t.row.chatCount))])]}},{key:"advancedChatCount",fn:function(t){return[-1==t.row.advancedChatCount?a("el-tag",{attrs:{type:"success"}},[e._v("无限制")]):0===t.row.advancedChatCount?a("el-tag",{attrs:{type:"danger"}},[e._v(e._s(t.row.advancedChatCount))]):t.row.advancedChatCount<5?a("el-tag",{attrs:{type:"warning"}},[e._v(e._s(t.row.advancedChatCount))]):a("el-tag",{attrs:{type:"success"}},[e._v(e._s(t.row.advancedChatCount))])]}},{key:"drawCount",fn:function(t){return[-1===t.row.drawCount?a("el-tag",{attrs:{type:"success"}},[e._v("无限制")]):0===t.row.drawCount?a("el-tag",{attrs:{type:"danger"}},[e._v(e._s(t.row.drawCount))]):t.row.drawCount<5?a("el-tag",{attrs:{type:"warning"}},[e._v(e._s(t.row.drawCount))]):a("el-tag",{attrs:{type:"success"}},[e._v(e._s(t.row.drawCount))])]}},{key:"state",fn:function(t){return[1==t.row.state?a("el-tag",{attrs:{type:"success"}},[e._v("正常")]):a("el-tag",{attrs:{type:"danger"}},[e._v("停用")])]}}])}),a("detail",{ref:"detail",attrs:{show:e.showDetail,member:e.detailModel},on:{changed:e.handleChanged,close:e.handleCloseDetail}})],1)},o=[],l=a("c7eb"),s=a("1da1"),i=(a("d3b7"),a("4de4"),a("d81d"),a("b0c0"),a("f4f7")),r=a("b775");function c(e){return Object(r["a"])({url:"/members",method:"get",params:e})}var d=a("c24f"),u=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-drawer",{staticStyle:{height:"100%"},attrs:{title:e.title,size:"80%",visible:e.show,"modal-append-to-body":!0,"before-close":e.handleClose}},[a("div",{staticStyle:{padding:"20px","overflow-y":"auto"}},[a("el-form",{ref:"form",staticStyle:{"padding-right":"180px"},attrs:{"label-width":"260px"}},[a("el-form-item",{attrs:{label:"用户名（账号）"}},[a("el-input",{attrs:{disabled:""},model:{value:e.member.username,callback:function(t){e.$set(e.member,"username",t)},expression:"member.username"}})],1),a("el-form-item",{attrs:{label:"密码"}},[a("el-button",{on:{click:e.handleShowChangePassword}},[e._v("修改密码")])],1),a("el-form-item",{attrs:{label:"昵称"}},[a("el-input",{attrs:{disabled:""},model:{value:e.member.name,callback:function(t){e.$set(e.member,"name",t)},expression:"member.name"}})],1),a("el-form-item",{attrs:{label:"邮箱"}},[a("el-input",{attrs:{disabled:""},model:{value:e.member.email,callback:function(t){e.$set(e.member,"email",t)},expression:"member.email"}})],1),a("el-form-item",{attrs:{label:"状态"}},[1==e.member.state?a("el-tag",{attrs:{type:"success"}},[e._v("正常")]):a("el-tag",{attrs:{type:"danger"}},[e._v("停用")])],1),a("el-form-item",{attrs:{label:"创建时间"}},[a("el-input",{attrs:{disabled:""},model:{value:e.member.createTime,callback:function(t){e.$set(e.member,"createTime",t)},expression:"member.createTime"}})],1)],1),a("el-tabs",{staticStyle:{padding:"10px"},on:{"tab-click":e.handleTabClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"套餐列表",name:"balance"}},[a("balances",{ref:"balances",attrs:{"user-id":e.member.id,member:e.member},on:{changed:e.handleBalanceChanged}})],1),a("el-tab-pane",{attrs:{label:"额度变动记录",name:"balanceRecord"}},[a("ai-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"table-actions":e.tableActions,"table-columns":e.tableColumns,"table-data":e.tableData,"table-action-column":e.tableActionColumn,pagination:e.pagination},on:{refresh:e.handleRefresh},scopedSlots:e._u([{key:"type",fn:function(t){return[a("el-tag",[e._v(e._s(e.getTypeText(t.row.typeId)))])]}},{key:"state",fn:function(t){return[1===t.row.state?a("el-tag",{attrs:{type:"success"}},[e._v("成功")]):e._e(),0===t.row.state?a("el-tag",{attrs:{type:"warning"}},[e._v("处理中")]):e._e(),2===t.row.state?a("el-tooltip",{attrs:{effect:"dark",content:e.getReason(t.row),placement:"top"}},[a("el-tag",{attrs:{type:"warning"}},[e._v("已回滚")])],1):e._e()]}},{key:"sourceId",fn:function(t){return[a("el-tag",[e._v(e._s(e.getSourceText(t.row.sourceId)))])]}}])})],1)],1),a("change-password",{ref:"password",attrs:{"password-dialog-visible":e.passwordDialogVisible,"show-old-password":!1},on:{close:e.handlePasswordDialogClose}})],1)])},p=[],h=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("ai-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"table-actions":e.tableActions,"table-columns":e.tableColumns,"table-data":e.tableData,"table-action-column":e.tableActionColumn,pagination:e.pagination},on:{refresh:e.handleRefresh},scopedSlots:e._u([{key:"leftColumns",fn:function(){return[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form",{attrs:{"label-position":"left",inline:""}},[a("el-form-item",{attrs:{label:"tokens"}},[a("span",[e._v(e._s(t.row.tokens))])]),a("el-form-item",{attrs:{label:"普通聊天次数"}},[a("span",[e._v(e._s(t.row.chatCount))])]),a("el-form-item",{attrs:{label:"高级聊天次数"}},[a("span",[e._v(e._s(t.row.advancedChatCount))])]),a("el-form-item",{attrs:{label:"绘画次数"}},[a("span",[e._v(e._s(t.row.drawCount))])])],1),1==t.row.calcTypeId?a("el-alert",{attrs:{title:"此为总额套餐，以上数值将会随着使用而减少",type:"success"}}):e._e(),[2,3,4].includes(t.row.calcTypeId)?a("el-alert",{attrs:{title:"此为周期套餐，以上数值表示周期内的总额，不会随着使用而减少",type:"success"}}):e._e()]}}])})]},proxy:!0},{key:"topActions",fn:function(){return[a("el-button",{attrs:{type:"primary"},on:{click:e.handleShowAddPackageDialog}},[e._v("增加套餐")])]},proxy:!0},{key:"sourceId",fn:function(t){return[a("el-tag",[e._v(e._s(e.getSourceText(t.row.sourceId)))])]}},{key:"calcTypeId",fn:function(t){return[a("el-tag",[e._v(e._s(e.getCalcTypeText(t.row.calcTypeId)))])]}},{key:"count",fn:function(t){return[a("span",[e._v(e._s(t.row.tokens)+", "+e._s(t.row.chatCount)+", "+e._s(t.row.advancedChatCount)+", "+e._s(t.row.drawCount))])]}},{key:"state",fn:function(t){return[a("el-tag",{attrs:{type:1==t.row.state?"primary":"danger"}},[e._v(e._s(e.getStateText(t.row.state)))])]}},{key:"rowActions",fn:function(t){return[1==t.row.state||2==t.row.state?a("el-button",{attrs:{type:2==t.row.state?"primary":"danger",plain:""},on:{click:function(a){return a.stopPropagation(),e.handleToggleEnable(t.row)}}},[e._v(" "+e._s(1==t.row.state?"废除":"恢复")+" ")]):e._e(),a("el-button",{attrs:{type:"primary"},on:{click:function(a){return a.stopPropagation(),e.handleShowQuotaEditDialog(t.row)}}},[e._v(" "+e._s(1==t.row.calcTypeId?"调整额度":"调整限额")+" ")])]}}])}),a("el-dialog",{attrs:{title:"为"+e.member.username+(1==e.increaseCalcTypeId?"调整额度":"调整限额"),visible:e.dialogVisible,"append-to-body":!0,"close-on-click-modal":!1,"close-on-press-escape":!1,width:"450px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{attrs:{"label-width":"80px"}},[a("el-form-item",{attrs:{label:"类型"}},[a("el-select",{model:{value:e.increaseType,callback:function(t){e.increaseType=t},expression:"increaseType"}},[a("el-option",{attrs:{label:"聊天次数",value:1}}),a("el-option",{attrs:{label:"高级聊天次数（GPT4）",value:2}}),a("el-option",{attrs:{label:"tokens",value:3}}),a("el-option",{attrs:{label:"绘画次数",value:4}})],1)],1),a("el-form-item",{attrs:{label:"次数"}},[a("el-input-number",{model:{value:e.increaseCount,callback:function(t){e.increaseCount=t},expression:"increaseCount"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{disabled:e.increasing},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary",disabled:e.increasing},on:{click:e.handleQuotaAdd}},[e._v(" "+e._s(e.increasing?"处理中":"确 定")+" ")])],1)],1),a("el-dialog",{attrs:{title:"为"+e.member.username+"增加套餐",visible:e.packageDialogVisible,"append-to-body":!0,width:"30%"},on:{"update:visible":function(t){e.packageDialogVisible=t}}},[a("el-form",{attrs:{"label-width":"100px"}},[a("el-form-item",{attrs:{label:"选择套餐"}},[a("el-select",{model:{value:e.packageId,callback:function(t){e.packageId=t},expression:"packageId"}},e._l(e.packages,(function(e){return a("el-option",{key:e.id,attrs:{label:e.title,value:e.id}})})),1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{disabled:e.increasing},on:{click:function(t){e.packageDialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary",disabled:e.increasing},on:{click:e.handlePackageAdd}},[e._v(" "+e._s(e.increasing?"处理中":"确 定")+" ")])],1)],1)],1)},f=[],g=a("5530");a("a9e3");function m(e){return Object(r["a"])({url:"/balances/"+e,method:"get",params:{}})}function b(e){return Object(r["a"])({url:"/balances/"+e+"/records",method:"get",params:{}})}function w(e){return Object(r["a"])({url:"/balances/"+e+"/enable",method:"put"})}function y(e){return Object(r["a"])({url:"/balances/"+e+"/disable",method:"put"})}function C(e,t,a,n){return Object(r["a"])({url:"/balances/increase",method:"post",params:{},data:{userId:e,type:a,count:n,balanceId:t}})}function v(e,t){return Object(r["a"])({url:"/balances/addPackage",method:"post",data:{userId:e,packageId:t}})}var k=a("a1f4"),_={name:"Balances",components:{AiTable:i["a"]},props:{userId:{type:Number,default:0},member:{type:Object,default:function(){}}},data:function(){return{loading:!1,tableActions:[],tableColumns:[{label:"#",prop:"id",width:55},{label:"来源",prop:"sourceId",slot:"sourceId"},{label:"类型",prop:"calcTypeId",slot:"calcTypeId"},{label:"次数",slot:"count",width:150},{label:"状态",prop:"state",slot:"state",width:75},{label:"创建时间",prop:"createTime",width:140},{label:"过期时间",prop:"expireTime",width:140}],tableData:[],tableActionColumn:{width:180},pagination:{total:0,showDetail:!1},dialogVisible:!1,increaseType:null,increaseCount:0,increasing:!1,increaseBalanceId:0,increaseCalcTypeId:0,packages:[],packageDialogVisible:!1,packageId:null}},mounted:function(){var e=this;Object(k["c"])().then((function(t){e.packages=t.data.map((function(e){return Object(g["a"])({},e)}))}))},methods:{reload:function(){var e=this;this.loading=!0,m(this.userId).then((function(t){console.log("resp",t),e.tableData=t.data.map((function(e){return{id:e.id,sourceId:e.sourceId,source:e.source,calcTypeId:e.calcTypeId,calcType:e.calcType,tokens:e.tokens,chatCount:e.chatCount,advancedChatCount:e.advancedChatCount,drawCount:e.drawCount,createTime:e.createTime,expireTime:e.expireTime,state:e.state}})),e.pagination.total=e.tableData.length})).finally((function(){e.loading=!1}))},handleRefresh:function(){this.reload()},handleToggleEnable:function(e){var t=this;this.$confirm(1===e.state?"套餐废除后用户将无法继续使用，确定废除#"+e.id+"套餐吗？":"确认恢复#"+e.id+"套餐吗？","操作确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(s["a"])(Object(l["a"])().mark((function a(){return Object(l["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.loading=!0,1===e.state?y(e.id).then((function(){t.$message.success("操作成功！"),t.reload()})).finally((function(){t.loading=!1})):w(e.id).then((function(){t.$message.success("操作成功！"),t.reload()})).finally((function(){t.loading=!1}));case 2:case"end":return a.stop()}}),a)}))))},handleShowQuotaEditDialog:function(e){this.dialogVisible=!0,this.increaseCount=0,this.increaseType=1,this.increaseBalanceId=e.id,this.increaseCalcTypeId=e.calcTypeId},handleQuotaAdd:function(){var e=this,t=+this.increaseCount;0!==t?(this.increasing=!0,C(this.member.id,this.increaseBalanceId,this.increaseType,t).then((function(t){console.log("resp",t),e.$message.success("操作成功！"),e.dialogVisible=!1,e.$emit("changed")})).catch((function(e){console.error(e)})).finally((function(){e.increasing=!1}))):this.$message.error("次数不能为0！")},handleShowAddPackageDialog:function(){this.packageDialogVisible=!0,this.packageId=null},handlePackageAdd:function(){var e=this;this.packageId?(this.increasing=!0,v(this.userId,this.packageId).then((function(){e.reload(),e.packageDialogVisible=!1})).finally((function(){e.increasing=!1}))):this.$message.error("请选择套餐！")},getSourceText:function(e){return{1:"注册",2:"每日签到",3:"邀请新用户",4:"购买",5:"后台操作"}[e]},getCalcTypeText:function(e){return{1:"总额",2:"每天",3:"每小时",4:"每3小时"}[e]},getStateText:function(e){return{0:"初始化",1:"正常",2:"废除"}[e]}}},D=_,I=a("2877"),T=Object(I["a"])(D,h,f,!1,null,"c64c52d8",null),x=T.exports,P=a("1f06"),S={name:"MemberDetail",components:{AiTable:i["a"],ChangePassword:P["a"],Balances:x},props:{member:{type:Object,default:function(){return[]}},show:{type:Boolean,default:!1}},data:function(){return{drawer:!0,loading:!1,activeName:"balance",tableActions:!1,tableColumns:[{label:"#",prop:"id",width:55},{label:"对应套餐",prop:"balanceId"},{label:"来源",prop:"sourceId",slot:"sourceId"},{label:"类型",prop:"typeId",slot:"type"},{label:"变动",prop:"delta",width:80},{label:"状态",slot:"state",width:80},{label:"时间",prop:"createTime",width:140}],tableData:[],tableActionColumn:{},pagination:{total:0,showDetail:!1},passwordDialogVisible:!1}},computed:{title:function(){return this.member.username+"详情"}},mounted:function(){},methods:{reload:function(){var e=this;this.member.id&&(this.loading=!0,this.$refs.balances.reload(),b(this.member.id).then((function(t){console.log("resp",t),e.tableData=t.data.map((function(e){return{id:e.id,type:e.type,typeId:e.typeId,delta:e.delta,balanceId:e.balanceId,createTime:e.createTime,state:e.state,source:e.source,sourceId:e.sourceId,reason:e.reason}})),e.pagination.total=e.tableData.length})).finally((function(){e.loading=!1})))},handleClose:function(){this.$emit("close")},handleRefresh:function(){this.reload()},handleTabClick:function(){},handleBalanceChanged:function(){this.reload()},getTypeText:function(e){return{1:"普通聊天",2:"高级聊天",3:"tokens",4:"绘图"}[e]||"未知"},getSourceText:function(e){return{1:"聊天消耗",2:"绘图消耗",3:"后台管理员增加",4:"注册赠送"}[e]||"未知"},handleShowChangePassword:function(){this.passwordDialogVisible=!0,this.$refs.password.init(this.member.id)},handlePasswordDialogClose:function(){console.log("handlePasswordDialogClose"),this.passwordDialogVisible=!1},getReason:function(e){if(!e.jsonReason)try{e.jsonReason=e.reason?JSON.parse(e.reason):null}catch(t){console.error(t)}return e.jsonReason||(e.jsonReason={message:"无具体回滚原因"}),e.jsonReason.message}}},$=S,j=(a("5793"),Object(I["a"])($,u,p,!1,null,"2824e03c",null)),A=j.exports,O={name:"MemberIndex",components:{AiTable:i["a"],Detail:A},data:function(){return{loading:!1,showDetail:!1,tableActions:[{key:"increase-tokens",label:"添加tokens",type:"primary"},{key:"tokens-record",label:"token记录"},{key:"message-record",label:"聊天记录"},{key:"edit",label:"编辑"}],tableColumns:[{label:"#",prop:"id",width:55},{label:"昵称",prop:"name"},{label:"登录账号",prop:"username"},{label:"登录邮箱",prop:"email"},{label:"状态",prop:"state",slot:"state",width:60},{label:"剩余tokens",prop:"tokens",slot:"tokens",width:120},{label:"剩余聊天次数",prop:"chatCount",slot:"chatCount",width:120},{label:"剩余高级聊天次数",prop:"advancedChatCount",slot:"advancedChatCount",width:120},{label:"剩余绘画次数",prop:"drawCount",slot:"drawCount",width:120},{label:"创建时间",prop:"createTime",width:140}],tableActionColumn:{width:165},tableData:[],pagination:{total:0,pageNum:1,pageSize:20},filter:{username:null,email:null},detailModel:{id:null,name:null,username:null,state:null,role:null,email:null,tokens:null,chatCount:null,advancedChatCount:null,drawCount:null,createTime:null}}},computed:{},created:function(){},mounted:function(){this.reload()},methods:{reload:function(){var e=this;return this.loading=!0,c({username:this.filter.username,email:this.filter.email,page:this.pagination.pageNum,size:this.pagination.pageSize}).then((function(t){console.log("resp",t);var a=t.data,n=a.list;e.tableData=n.map((function(e){return{id:e.id,username:e.username,name:e.name,tokens:e.tokens,role:e.role,state:e.state,email:e.email,chatCount:e.chatCount,advancedChatCount:e.advancedChatCount,drawCount:e.drawCount,createTime:e.createTime,updateTime:e.updateTime}})),e.pagination.total=a.total,e.pagination.pageNum=a.pageNum,e.pagination.pageSize=a.pageSize})).then((function(){if(console.log("this.showDetail",e.showDetail),e.showDetail){var t=e.tableData.filter((function(t){return t.id===e.detailModel.id}))[0];console.log("row",t),t&&e.updateDetail(t)}})).finally((function(){e.loading=!1}))},updateDetail:function(e){var t=this;console.log("updateDetail"),this.detailModel={id:e.id,name:e.name,username:e.username,state:e.state,role:e.role,tokens:e.tokens,email:e.email,chatCount:e.chatCount,advancedChatCount:e.advancedChatCount,drawCount:e.drawCount,createTime:e.createTime},this.$nextTick((function(){t.$refs.detail.reload()}))},handleSearch:function(){this.pagination.pageNum=1,this.reload()},handleRefresh:function(){this.reload()},handlePageSizeChange:function(e){this.pagination.pageNum=1,this.pagination.pageSize=e,this.reload()},handlePageCurrentChanged:function(e){console.log("page",e),this.pagination.pageNum=e,this.reload()},handleCreate:function(){this.$message.warning("开发中……")},handleEdit:function(e){this.showDetail=!0,this.updateDetail(e)},handleCloseDetail:function(){this.showDetail=!1},handleChanged:function(){this.reload()},handleToggleEnable:function(e){var t=this;console.log("handleToggleEnable"),this.$confirm(1===e.state?"确定对"+e.username+"进行停用吗？":"确定对"+e.username+"取消停用吗？","操作确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(s["a"])(Object(l["a"])().mark((function a(){var n;return Object(l["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:n=2===e.state,Object(d["c"])(e.id,n).then((function(e){console.log("resp",e),t.$message.success("操作成功！"),t.reload()}));case 2:case"end":return a.stop()}}),a)}))))},handleResetFilter:function(){this.filter.username="",this.filter.email="",this.pagination.pageNum=1,this.reload()},getStateName:function(e){return{1:"正常",2:"禁用"}[e]||"未知"}}},R=O,N=(a("6dff"),Object(I["a"])(R,n,o,!1,null,"ba5c5298",null));t["default"]=N.exports},f4f7:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"comp-container"},[a("div",{staticClass:"filter-container"},[e._t("filter")],2),a("div",{staticClass:"table-container",staticStyle:{padding:"20px"}},[a("div",{staticClass:"operation-container",staticStyle:{"margin-bottom":"10px","padding-left":"10px"}},[a("el-button",{attrs:{icon:"el-icon-refresh",circle:""},on:{click:e.handleClickRefreshButton}}),e._t("topActions")],2),e._t("header"),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",stripe:""},on:{"row-click":e.handleRowClick,"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._t("leftColumns"),e._l(e.tableColumns,(function(t){return a("el-table-column",{key:t.prop,attrs:{prop:t.prop,label:t.label,width:t.width,type:t.type,"show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(a){return e._t(t.slot,[e._v(" "+e._s(a.row[t.prop])+" ")],{row:a.row})}}],null,!0)})})),e._t("columns"),e.tableActions?a("el-table-column",{attrs:{label:"操作",width:e.tableActionColumn?e.tableActionColumn.width:0},scopedSlots:e._u([{key:"default",fn:function(t){return e._t("rowActions",null,{row:t.row})}}],null,!0)},e._l(e.tableActions,(function(t){return a("el-button",{key:t.key,attrs:{type:t.type}},[e._v(" "+e._s(t.label)+" ")])})),1):e._e()],2),a("el-pagination",{staticStyle:{"margin-top":"10px"},attrs:{"current-page":e.pagination.pageNum,"page-sizes":[20,200,500],"page-size":e.pagination.pageSize,layout:e.paginationLayout,total:e.pagination.total||0},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],2)])},o=[],l={name:"AiTable",components:{},props:{tableActions:{type:[Array,Boolean],default:function(){return[]}},tableColumns:{type:Array,default:function(){return[]}},tableActionColumn:{type:Object,default:function(){}},tableData:{type:Array,default:function(){return[]}},pagination:{type:Object,default:function(){}},loading:{type:Boolean,default:!1}},data:function(){return{currentPage:1}},computed:{paginationLayout:function(){if(!this.pagination)return"";var e=this.pagination.showDetail;return!1===e?"total":"total, sizes, prev, pager, next, jumper"}},created:function(){},methods:{handleSizeChange:function(e){this.$emit("pageSizeChanged",e)},handleCurrentChange:function(e){this.$emit("pageCurrentChanged",e)},handleRowClick:function(e){this.$refs.multipleTable.toggleRowSelection(e)},handleSelectionChange:function(){},handleClickRefreshButton:function(){this.$emit("refresh")}}},s=l,i=(a("757a"),a("2877")),r=Object(i["a"])(s,n,o,!1,null,"61d77082",null);t["a"]=r.exports}}]);